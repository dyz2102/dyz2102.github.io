<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Today we began introducing order status management using AASM gem. This allowed for order status to be managed more efficiently and effectively.
In order to change order status, an event (keyword) mus">
<meta property="og:type" content="article">
<meta property="og:title" content="Day04 Week03 - Using AASM Status to Manage Orders">
<meta property="og:url" content="http://yoursite.com/2016/11/03/2016-11-03-day04-week03/index.html">
<meta property="og:site_name" content="DYZ.Life">
<meta property="og:description" content="Today we began introducing order status management using AASM gem. This allowed for order status to be managed more efficiently and effectively.
In order to change order status, an event (keyword) mus">
<meta property="og:image" content="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/tkPd9OpkQy2CnwJA3au9_Screen%20Shot%202016-11-03%20at%203.43.10%20PM.png">
<meta property="og:image" content="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/fWsC9xJgTlXRX9IxIKA9_Screen%20Shot%202016-11-03%20at%203.44.01%20PM.png">
<meta property="og:image" content="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/bea4oTnCTKyWOhViLNAP_Screen%20Shot%202016-11-03%20at%203.43.29%20PM.png">
<meta property="og:updated_time" content="2016-12-17T06:10:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Day04 Week03 - Using AASM Status to Manage Orders">
<meta name="twitter:description" content="Today we began introducing order status management using AASM gem. This allowed for order status to be managed more efficiently and effectively.
In order to change order status, an event (keyword) mus">
<meta name="twitter:image" content="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/tkPd9OpkQy2CnwJA3au9_Screen%20Shot%202016-11-03%20at%203.43.10%20PM.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/11/03/2016-11-03-day04-week03/"/>





  <title> Day04 Week03 - Using AASM Status to Manage Orders | DYZ.Life </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">DYZ.Life</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">用文字帮助思考</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/03/2016-11-03-day04-week03/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="朱英楠David">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/tshirt_fullstack.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="DYZ.Life">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="DYZ.Life" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Day04 Week03 - Using AASM Status to Manage Orders
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-03T03:30:00+08:00">
                2016-11-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/11/03/2016-11-03-day04-week03/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/11/03/2016-11-03-day04-week03/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Today we began introducing order status management using AASM gem. This allowed for order status to be managed more efficiently and effectively.</p>
<p>In order to change order status, an <em>event</em> (keyword) must be invoked in the controller. The <em>event</em> is triggered by a post request from views. This completes the MVC loop.</p>
<p>How to add a new <code>:post</code> action:</p>
<ol>
<li>Create post path in <em>route</em> and <code>rake db:migrate</code></li>
<li>Define post action in <em>controller</em>, linking another “<em>action</em>!”</li>
<li>Create “<em>action</em>!” in <em>model</em></li>
<li>Create button in <em>views</em>, linking to path in <em>route</em>, remember to add <code>:method =&gt; :post</code></li>
</ol>
<p>I also jot down some important notes and learning points that I found useful:</p>
<p><strong>How to change AASM state manually in terminal console:</strong></p>
<p>_[recommend first install <em>gem awesome_rails_console</em> to better view console results]_</p>
<ol>
<li>See all orders by using <code>Order.all</code></li>
<li>Find the one you want by using <code>Order.find(#)</code> with # = the ID number</li>
<li>Define a variable for this order <code>AAA = Order.find(#)</code></li>
<li>Check the AASM state of the order <code>AAA.aasm_state</code></li>
<li>Assign new AASM state (in this case we’ll use “paid”) <code>AAA.aasm_state = &quot;paid&quot;</code></li>
<li>Save <code>AAA.save!</code> (Must add “!” here to force save into the Order, otherwise only the variable AAA’s aasm state will be saved but not when you check again in Order)</li>
</ol>
<p><strong>Important Distinction Between = vs. ===</strong></p>
<p>When I tried to build an <em>if… end</em> statement using = to check value, it didn’t work. This is because = assigns value to a variable, not checking if there is an equality relationship. I changed this to === and it worked. This is a very juvenile mistake that I don’t think will happen again.</p>
<p><strong>Important Distinction Between Array and Single Variable</strong></p>
<p>When I tried to pull the admin user’s email address to send a notification email, the email pull could not work. In the console, I was told the “email” method was undefined.</p>
<p><img src="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/tkPd9OpkQy2CnwJA3au9_Screen%20Shot%202016-11-03%20at%203.43.10%20PM.png" alt="Screen Shot 2016-11-03 at 3.43.10 PM.png"></p>
<p>So I checked <em>order.user</em> vs. <em>User.where(is_admin: true)</em>:</p>
<p><img src="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/fWsC9xJgTlXRX9IxIKA9_Screen%20Shot%202016-11-03%20at%203.44.01%20PM.png" alt="Screen Shot 2016-11-03 at 3.44.01 PM.png"></p>
<p><img src="http://user-image.logdown.io/user/19391/blog/18870/post/1070126/bea4oTnCTKyWOhViLNAP_Screen%20Shot%202016-11-03%20at%203.43.29%20PM.png" alt="Screen Shot 2016-11-03 at 3.43.29 PM.png"></p>
<p>Initially they looked the same to me. Then I noticed the <code>[0]</code> in front of the user details. I know that <code>[ ]</code> indicates an array, and <code>0</code> would be the position of the value in the array. So this is an array with just 1 value. Which meant that I had to specify which value in the array I wanted to call in order for the <code>.email</code> method to work. So I added <code>.first</code> at the end of the variable and pulled the email address successfully.</p>
<p><strong>How to correctly use Roadie Rails automatically</strong></p>
<p>I checked the <code>gem roadie-rails</code> <a href="https://github.com/Mange/roadie-rails" target="_blank" rel="external">website</a>, for whatever reason they didn’t mention how to include the <em>stylesheet</em> inside the email template.</p>
<figure class="highlight ruby"><figcaption><span>app/views/order_mailer/notify_order_placed.html.erb</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ &lt;link rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span> href=<span class="string">"/assets/application.scss"</span> /&gt;</div></pre></td></tr></table></figure>
<p>This is a key step and without it the CSS would obviously not show up. For a more complete step-by-step simple installation, please see <a href="http://yy4ever.logdown.com/posts/1070697-using-roadie-rails-display-css-layouts" target="_blank" rel="external">here</a>.</p>
<p>I have completed everything in the development stage at this point. The next step will be deployment onto <em>Heroku</em>, which will require an email client (<em>MailGun</em>), a password manager (<em>figaro</em>), and an image host, in addition to a number of issues that may come up along the way. I now understand why it is <strong>critical</strong> to leave out 1/3 of the time for deployment and user testing.</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/02/2016-11-02-day03-week03-shopping-site-with-order-delivery/" rel="next" title="Day03 Week03 - Shopping Site with Order Status">
                <i class="fa fa-chevron-left"></i> Day03 Week03 - Shopping Site with Order Status
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/04/2016-11-04-manage-aws-key-using-figaro-on-heroku-for-carrierwave/" rel="prev" title="【功能】Managing AWS Key Using Figaro on Heroku for CarrierWave">
                【功能】Managing AWS Key Using Figaro on Heroku for CarrierWave <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox">
  <script type = "text/javascript" src = "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-585582358ed3985c" async = "async" ></script>
</div>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/tshirt_fullstack.jpg"
               alt="朱英楠David" />
          <p class="site-author-name" itemprop="name">朱英楠David</p>
          <p class="site-description motion-element" itemprop="description">Aim for the moon, <br>  and land among the stars.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">112</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/dyz2102" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/davidyzhu" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://cn.linkedin.com/in/davidyzhu" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  LinkedIn
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/zhuyingnan" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-question-circle-o"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-telegram"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">朱英楠David</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'dyzblog';
      var disqus_identifier = '2016/11/03/2016-11-03-day04-week03/';

      var disqus_title = "Day04 Week03 - Using AASM Status to Manage Orders";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      

    </script>
  





  
  

  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
